{% extends "base.html" %}
{% block title %}Statistiques — CineFinder{% endblock %}

{% block content %}

<section class="kpis kpis-compact">
  <div class="kpi">
    <h3>Films en base</h3>
    <div class="value">{{ total_films }}</div>
  </div>

  <div class="kpi">
    <h3>Note moyenne</h3>
    <div class="value">{% if avg_rating is not none %}{{ avg_rating }}{% else %}—{% endif %}</div>
    <div class="sub">{{ rated_count }} notés</div>
  </div>
</section>

<div class="stats-grid stats-grid-2">
  <section class="stats-card">
    <div class="card-head">
      <h2>Top genres</h2>
    </div>

    {% if top_genres and top_genres|length > 0 %}
      <table class="table">
        <thead>
          <tr>
            <th>Genre</th>
            <th style="text-align:right;">Films</th>
          </tr>
        </thead>
        <tbody>
          {% for g in top_genres %}
            <tr>
              <td>{{ g._id }}</td>
              <td style="text-align:right;"><span class="badge-count">{{ g.count }}</span></td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="muted">Pas assez de données.</p>
    {% endif %}
  </section>

  <section class="stats-card">
    <div class="card-head">
      <h2>Distribution des notes</h2>
    </div>

    {% if hist_labels and hist_labels|length > 0 %}
      <div class="bars">
        {% for i in range(hist_labels|length) %}
          {% set label = hist_labels[i] %}
          {% set count = hist_counts[i] %}
          {% set pct = (count / max_hist * 100) if max_hist else 0 %}
          <div class="bar-row">
            <div class="bar-label">{{ label }}</div>
            <div class="bar-track">
              <div class="bar-fill" style="width: {{ pct }}%;"></div>
            </div>
            <div class="bar-value">{{ count }}</div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="muted">Pas assez de films notés.</p>
    {% endif %}
  </section>

  <section class="stats-card">
    <div class="card-head">
      <h2>Top réalisateurs</h2>
    </div>

    {% if top_directors and top_directors|length > 0 %}
      <table class="table">
        <thead>
          <tr>
            <th>Réalisateur</th>
            <th style="text-align:right;">Films</th>
          </tr>
        </thead>
        <tbody>
          {% for d in top_directors %}
            <tr>
              <td>{{ d._id }}</td>
              <td style="text-align:right;"><span class="badge-count">{{ d.count }}</span></td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="muted">Pas assez de données.</p>
    {% endif %}
  </section>

  <section class="stats-card">
    <div class="card-head">
      <h2>Films par décennie</h2>
    </div>

    {% if films_by_decade and films_by_decade|length > 0 %}
      <table class="table">
        <thead>
          <tr>
            <th>Décennie</th>
            <th style="text-align:right;">Films</th>
          </tr>
        </thead>
        <tbody>
          {% for row in films_by_decade %}
            <tr>
              <td>{{ row._id }}s</td>
              <td style="text-align:right;"><span class="badge-count">{{ row.count }}</span></td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="muted">Pas assez de données.</p>
    {% endif %}
  </section>
</div>

{% endblock %}
